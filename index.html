<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—É–±–∏–∫ –ú–∞—Å—Ç–µ—Ä–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: white;
            text-align: center;
        }

        .dice-container {
            perspective: 1000px;
            margin: 2rem 0;
        }

        .dice {
            width: 100px;
            height: 100px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1.5s ease-out;
        }

        .dice-face {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.2);
        }

        /* –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≥—Ä–∞–Ω–µ–π –∫—É–±–∏–∫–∞ */
        .face-1 { transform: rotateY(0deg) translateZ(50px); }
        .face-2 { transform: rotateY(180deg) translateZ(50px); }
        .face-3 { transform: rotateY(90deg) translateZ(50px); }
        .face-4 { transform: rotateY(-90deg) translateZ(50px); }
        .face-5 { transform: rotateX(90deg) translateZ(50px); }
        .face-6 { transform: rotateX(-90deg) translateZ(50px); }

        .roll-button {
            background: #ffde55;
            color: #333;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .roll-button:hover {
            background: #ffd429;
            transform: translateY(-2px);
        }

        .result {
            font-size: 1.5rem;
            margin-top: 1rem;
            min-height: 2rem;
        }
    </style>
</head>
<body>
    <h1>–ë—Ä–æ—Å–æ–∫ D20</h1>
    <p>–ù–∞–∂–º–∏—Ç–µ "–ë—Ä–æ—Å–∏—Ç—å", —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–≤–æ—é —Å—É–¥—å–±—É</p>

    <div class="dice-container">
        <div class="dice" id="dice">
            <!-- –ì—Ä–∞–Ω–∏ –∫—É–±–∏–∫–∞ D20. –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ —Å–¥–µ–ª–∞–µ–º 6-–≥—Ä–∞–Ω–Ω—ã–π, –Ω–æ –ª–æ–≥–∏–∫–∞ –±—É–¥–µ—Ç –¥–ª—è 20 -->
            <div class="dice-face face-1">1</div>
            <div class="dice-face face-2">2</div>
            <div class="dice-face face-3">3</div>
            <div class="dice-face face-4">4</div>
            <div class="dice-face face-5">5</div>
            <div class="dice-face face-6">6</div>
        </div>
    </div>

    <div class="result" id="result"></div>
    <button class="roll-button" id="rollButton">üé≤ –ë—Ä–æ—Å–∏—Ç—å</button>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); // –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
        tg.BackButton.hide(); // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥", –º—ã –∑–∞–∫—Ä–æ–µ–º—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

        const diceElement = document.getElementById('dice');
        const resultElement = document.getElementById('result');
        const rollButton = document.getElementById('rollButton');

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —á–∏—Å–ª–∞ –¥–ª—è D20
        function rollD20() {
            return Math.floor(Math.random() * 20) + 1;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≤—Ä–∞—â–µ–Ω–∏—è –∫ –∫—É–±–∏–∫—É
        function applyRandomRotation() {
            const randomX = Math.floor(Math.random() * 10 + 15);
            const randomY = Math.floor(Math.random() * 10 + 15);
            const randomZ = Math.floor(Math.random() * 10 + 15);
            diceElement.style.transform = `rotateX(${randomX}deg) rotateY(${randomY}deg) rotateZ(${randomZ}deg)`;
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –±—Ä–æ—Å–∫–∞
        rollButton.addEventListener('click', () => {
            // 1. –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ –≤—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏
            rollButton.disabled = true;
            resultElement.textContent = '';

            // 2. –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –≤—Ä–∞—â–µ–Ω–∏—è (–Ω–µ—Å–∫–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã—Ö "–ø—Ä–æ–∫—Ä—É—Ç–æ–∫")
            let rolls = 0;
            const maxRolls = 10; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –≤—Ä–∞—â–µ–Ω–∏–π –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
            const rollInterval = setInterval(() => {
                applyRandomRotation();
                rolls++;
                if (rolls >= maxRolls) {
                    clearInterval(rollInterval);
                    // 3. –§–∏–Ω–∞–ª—å–Ω–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    setTimeout(() => {
                        const finalResult = rollD20(); // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                        applyRandomRotation(); // –§–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ–≤–æ—Ä–æ—Ç
                        resultElement.textContent = `–í—ã–ø–∞–ª–æ: ${finalResult}!`;

                        // 4. –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –±–æ—Ç–∞ –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º Mini App
                        setTimeout(() => {
                            // –û–¢–ü–†–ê–í–õ–Ø–ï–ú –î–ê–ù–ù–´–ï –í –ë–û–¢–ê
                            // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–π–¥—É—Ç –ø—Ä—è–º–æ –≤ –≤–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é ai_generate_response
                            const webAppData = {
                                action: 'dice_roll', // –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, —á—Ç–æ–±—ã –±–æ—Ç –ø–æ–Ω—è–ª, —á—Ç–æ —ç—Ç–æ –±—Ä–æ—Å–æ–∫
                                dice_type: 'd20',
                                value: finalResult,
                                // –ú–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –ª—é–±—É—é –¥—Ä—É–≥—É—é –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                                original_prompt: "–ë—Ä–æ—Å–æ–∫ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã –≤ –±–æ—é!" // –ù–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –ò–ò –ø–æ–Ω–∏–º–∞–ª –∫–æ–Ω—Ç–µ–∫—Å—Ç
                            };

                            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω–æ –≤ –±–æ—Ç–∞ –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º Mini App
                            tg.sendData(JSON.stringify(webAppData));
                            tg.close();

                        }, 1500); // –î–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 1.5 —Å–µ–∫—É–Ω–¥—ã —É–≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

                    }, 200);
                }
            }, 100); // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 100–º—Å
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥—Ä—É–≥–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–∫—É–ø–∫–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–µ)
        function buyItem(itemId) {
            // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–∏—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä (–±–æ—Ç) –Ω–∞ –ø–æ–∫—É–ø–∫—É
            const purchaseData = {
                action: 'buy_item',
                item_id: itemId
            };
            tg.sendData(JSON.stringify(purchaseData));
            // –ò–ª–∏ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞–ø—Ä—è–º—É—é –∫ API –≤–∞—à–µ–≥–æ –±–æ—Ç–∞, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
        }
    </script>
</body>
</html>
